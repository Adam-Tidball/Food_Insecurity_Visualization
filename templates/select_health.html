{% set provinces = ['Alberta', 'British Columbia', 'Manitoba', 'New Brunswick', 'Newfoundland and Labrador', 'Nova Scotia', 'Ontario', 'Prince Edward Island', 'Quebec', 'Saskatchewan'] %}
{% set Sub_Characteristics = ['Perceived health, very good or excellent', 'Perceived health, fair or poor', 'Perceived mental health, very good or excellent', 'Perceived mental health, fair or poor', 'Body mass index, adjusted self-reported, adult (18 years and over), obese', 'Diabetes', 'High blood pressure', 'Asthma', 'Mood disorder', 'Anxiety disorder'] %}
<!-- {% set Characteristics = ['Perceived health, very good or excellent', 'Perceived health, fair or poor', 'Perceived mental health, very good or excellent', 'Perceived mental health, fair or poor', 'Perceived life stress, most days quite a bit or extremely stressful', 'Body mass index, adjusted self-reported, adult (18 years and over), overweight', 'Body mass index, adjusted self-reported, adult (18 years and over), obese', 'Body mass index, self-reported, youth (12 to 17 years old), overweight or obese', 'Arthritis (15 years and over)', 'Diabetes', 'Asthma', 'Chronic obstructive pulmonary disease (COPD; 35 years and over)', 'High blood pressure', 'Mood disorder', 'Anxiety disorder', 'Current smoker, daily or occasional', 'Current smoker, daily', 'Cannabis use, past 12 months', 'Cannabis frequency of use in the past 12 months, daily or almost daily', 'Ever used e-cigarette or vaping device', 'Used e-cigarette or vaping device, past 30 days', 'Heavy drinking', 'Self-reported physical activity, 150 minutes per week, adult (18 years and over)', 'Self-reported physical activity, average 60 minutes per day, youth (12 to 17 years old)', 'Breast milk feeding initiation', 'Exclusive breastfeeding, at least 6 months', 'Fruit and vegetable consumption, 5 times or more per day', 'Sense of belonging to local community, somewhat strong or very strong', 'Life satisfaction, satisfied or very satisfied', 'Has a regular healthcare provider', 'Contact with a medical doctor in the past 12 months', 'Influenza immunization in the past 12 months'] %} -->

<div id="select_health" class ="w-full h-full" style="display: flex; flex-wrap: wrap;">
<div class="bg-red-200 w-1/2">

    <div style="font-size: large;">
        Select Provinces
    </div>
    
    
    {% for province in provinces %}
    <div>
        <label class="container">
            <input type="checkbox" class="province-checkbox" value="{{ province }}" {% if province in ['British Columbia'] %}checked{% endif %}>
            <span class="checkmark"></span>
            {{ province }}
        </label>
    </div>
    {% endfor %}

</div>
<div class="bg-blue-200 w-1/2">

    <div style="font-size: large;">
        Select Health Characteristics
    </div>
    
    
    {% for characteristic in Sub_Characteristics %}
    <div>
        <label class="container">
            <input type="checkbox" class="characteristic-checkbox" value="{{ characteristic }}" {% if characteristic in ['Perceived health, very good or excellent', 'Perceived health, fair or poor'] %}checked{% endif %}>
            <span class="checkmark"></span>
            {{ characteristic }}
        </label>
    </div>
    {% endfor %}

</div>
</div>


<!-- Logic for checkbox updates -->

<script>    
    document.addEventListener('DOMContentLoaded', function() {
    // Arrays to hold the selections
    let selectedProvinces = [];
    let selectedCharacteristics = [];

    // Function to update the selection arrays
    function updateSelections() {
        selectedProvinces = []; // Reset the array
        document.querySelectorAll('.province-checkbox:checked').forEach(function(checkbox) {
            selectedProvinces.push(checkbox.value);
        });

        selectedCharacteristics = []; // Reset the array
        document.querySelectorAll('.characteristic-checkbox:checked').forEach(function(checkbox) {
            selectedCharacteristics.push(checkbox.value);
        });

        // AJAX request to fetch filtered data
        fetch('../filter_data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                provinces: selectedProvinces,
                characteristics: selectedCharacteristics,
            }),
        })
        .then(response => response.json())
        .then(data => {
            console.log(data)
            updateCircleChartSelection(data['provinces'], "Diabetes")
            updateLineChart(data); // Call function to update the chart with new data
        })
        .catch(error => console.error('Error fetching data:', error));
    }
    

    // Add event listeners to checkboxes to trigger updateSelections
    document.querySelectorAll('.province-checkbox').forEach(function(checkbox) {
        checkbox.addEventListener('change', updateSelections);
    });
    document.querySelectorAll('.characteristic-checkbox').forEach(function(checkbox) {
        checkbox.addEventListener('change', updateSelections);
    });
});
</script>